<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        let numbers = [];

        while (true) {
            let value = prompt(`Введите число. Оно запишется в массив. 
Для остановки ввода нажмите на кнопку Отмена, esc или введите не число.`, 0);

            if (value === "" || value === null || !isFinite(value)) break;
            numbers.push(+value);
        }

        alert("Введенный массив чисел: " + numbers);

        let sortArray = sortElements(numbers);
        let rangeArray = rangeElements(sortArray);
        let rangeNumbersObject = createRangeObject(sortArray, rangeArray);
        let result = createResult(numbers, rangeNumbersObject);

        alert("Массив с рангами чисел: " + result);

        function sortElements(arr) {
            let arr2 = arr.slice();

            for (let i = 0; i < arr2.length - 1; i++) {
                for (let j = 0; j < arr2.length - 1 - i; j++) {
                    if (arr2[j + 1] < arr2[j]) { let t = arr2[j + 1]; arr2[j + 1] = arr2[j]; arr2[j] = t; }
                }
            }
            return arr2;
        }

        function rangeElements(arr) {
            let arr2 = arr.slice();
            let ranges = [], ranges2 = [];

            for (i = 0; i < arr2.length; i++) {
                ranges[i] = i + 1;
            }

            outer: for (i = 0; i < arr2.length; i++) {
                let n = 1, sum = ranges[i];

                for (j = i + 1; j < arr2.length; j++) {

                    if (arr2[i] == null) continue outer;

                    if (arr2[i] == arr2[j]) {
                        sum += ranges[j];
                        n++;
                        arr2.splice(j, 1, null);
                    }
                }
                let newRange = sum / n;

                for (k = 0; k < n; k++) {
                    ranges2.push(newRange);
                }
            }
            return ranges2;
        }

        function createRangeObject(sortArr, rangeArr) {
            let rangeObject = {};

            for (i = 0; i < sortArr.length; i++) {
                rangeObject[sortArr[i]] = rangeArr[i];
            }
            return rangeObject;
        }

        function createResult(initialArray, rangeObject) {
            let resultArray = [];

            for (i = 0; i < initialArray.length; i++) {
                resultArray[i] = rangeObject[initialArray[i]];
            }
            return resultArray;
        }
    </script>
</body>

</html>